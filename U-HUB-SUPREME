local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
math.randomseed(tick())

_G.U_HUB_CORE = {
    AimbotEnabled = false,
    AimPart = "Head",
    Sensitivity = 0.1,
    FovEnabled = true,
    FovRadius = 150,
    UnlockMouse = true
}

-- [[ 1. สร้างหน้าต่าง ]]
local Window = Fluent:CreateWindow({
    Title = "U-HUB SUPREME",
    SubTitle = "BY Neung",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.U 
})

-- [[ 2. ระบบปลดเมาส์ ]]
RunService.PostSimulation:Connect(function()
    if not Window.Minimized and _G.U_HUB_CORE.UnlockMouse then
        UserInputService.MouseIconEnabled = true
        UserInputService.MouseBehavior = Enum.MouseBehavior.Default
    end
end)

-- [[ 3. ระบบปุ่มลอยวิบวับ (ห้ามหาย!) ]]
local function SetupLogoV50(MainBtn)
    local Container = Instance.new("Frame", MainBtn)
    Container.Size = UDim2.new(1, 0, 1, 0); Container.BackgroundTransparency = 1; Container.ClipsDescendants = true
    for i = 1, 15 do
        local d = Instance.new("Frame", Container)
        d.Size = UDim2.new(0, 1, 0, 1); d.BackgroundColor3 = Color3.fromRGB(255, 255, 255); d.Position = UDim2.new(math.random(), 0, math.random(), 0)
        task.spawn(function() while task.wait(math.random(2, 4)) do TweenService:Create(d, TweenInfo.new(1), {BackgroundTransparency = 1}):Play(); task.wait(1.2); TweenService:Create(d, TweenInfo.new(1), {BackgroundTransparency = 0.4}):Play() end end)
    end
    local function CreateChar(txt, color)
        local h = Instance.new("Frame", Container); h.Size = UDim2.new(1, 0, 1, 0); h.BackgroundTransparency = 1
        local l = Instance.new("TextLabel", h); l.Text = txt; l.TextColor3 = color; l.Font = Enum.Font.GothamBold; l.Size = UDim2.new(1, 0, 1, 0); l.BackgroundTransparency = 1
        task.spawn(function() while true do TweenService:Create(l, TweenInfo.new(1.5, Enum.EasingStyle.Sine), {Position = UDim2.new(0,0,0,2)}):Play(); task.wait(1.5); TweenService:Create(l, TweenInfo.new(1.5, Enum.EasingStyle.Sine), {Position = UDim2.new(0,0,0,-2)}):Play(); task.wait(1.5) end end)
        return h, l
    end
    local holderU, textU = CreateChar("U", Color3.fromRGB(0, 255, 100)); local holderN, textN = CreateChar("N", Color3.fromRGB(0, 170, 255))
    holderU.Position = UDim2.new(0,0,0,0); textU.TextSize = 35; holderN.Position = UDim2.new(-0.25,0,-0.25,0); textN.TextSize = 14
    return function(isMinimized)
        if isMinimized then TweenService:Create(holderU, TweenInfo.new(0.4), {Position = UDim2.new(0,0,0,0)}):Play(); textU.TextSize = 35; TweenService:Create(holderN, TweenInfo.new(0.4), {Position = UDim2.new(-0.25,0,-0.25,0)}):Play(); textN.TextSize = 14
        else TweenService:Create(holderN, TweenInfo.new(0.4), {Position = UDim2.new(0,0,0,0)}):Play(); textN.TextSize = 35; TweenService:Create(holderU, TweenInfo.new(0.4), {Position = UDim2.new(-0.25,0,-0.25,0)}):Play(); textU.TextSize = 14 end
    end
end

local ScreenGui = Instance.new("ScreenGui", game.CoreGui); local MainBtn = Instance.new("Frame", ScreenGui)
MainBtn.Size = UDim2.new(0, 60, 0, 60); MainBtn.Position = UDim2.new(0.1, 0, 0.4, 0); MainBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0); MainBtn.Active = true
Instance.new("UICorner", MainBtn).CornerRadius = UDim.new(0, 12); local UpdateLogo = SetupLogoV50(MainBtn)

local dragging, dragStart, startPos, startTime
MainBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true; startTime = tick(); dragStart = input.Position; startPos = MainBtn.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false
        if tick() - startTime < 0.25 then Window:Minimize(); task.wait(0.05); UpdateLogo(Window.Minimized) end end end)
    end
end)
UserInputService.InputChanged:Connect(function(input) if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then local delta = input.Position - dragStart; MainBtn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)

-- [[ 4. TABS ]]
local Tabs = { Combat = Window:AddTab({ Title = "Combat", Icon = "target" }), Visuals = Window:AddTab({ Title = "Visuals", Icon = "eye" }) }
Tabs.Combat:AddToggle("MouseLock", {Title = "Unlock Mouse", Default = true}):OnChanged(function(v) _G.U_HUB_CORE.UnlockMouse = v end)
Tabs.Combat:AddToggle("AimToggle", {Title = "Auto Lock", Default = false}):OnChanged(function(v) _G.U_HUB_CORE.AimbotEnabled = v end)
Tabs.Combat:AddSlider("Smooth", { Title = "Lock Speed", Default = 0.1, Min = 0.01, Max = 1, Rounding = 2, Callback = function(v) _G.U_HUB_CORE.Sensitivity = v end })
Tabs.Visuals:AddToggle("ShowFOV", {Title = "Show FOV", Default = true}):OnChanged(function(v) _G.U_HUB_CORE.FovEnabled = v end)
Tabs.Visuals:AddSlider("FOVSize", { Title = "FOV Radius", Default = 150, Min = 50, Max = 800, Rounding = 0, Callback = function(v) _G.U_HUB_CORE.FovRadius = v end })

-- [[ 5. LOGIC ENGINE ]]
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 1; FOVCircle.NumSides = 100; FOVCircle.Filled = false; FOVCircle.Transparency = 0.8; FOVCircle.Color = Color3.fromRGB(0, 255, 100)

local function IsVisible(Part)
    local CastPoints = {Camera.CFrame.Position, Part.Position}
    local Params = RaycastParams.new(); Params.FilterType = Enum.RaycastFilterType.Exclude; Params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    local Result = workspace:Raycast(CastPoints[1], CastPoints[2] - CastPoints[1], Params)
    return Result == nil or Result.Instance:IsDescendantOf(Part.Parent)
end

local function GetClosestPlayer()
    local Target, Distance = nil, _G.U_HUB_CORE.FovRadius
    local Center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild(_G.U_HUB_CORE.AimPart) and v.Character.Humanoid.Health > 0 then
            local Part = v.Character[_G.U_HUB_CORE.AimPart]
            local ScreenPos, OnScreen = Camera:WorldToViewportPoint(Part.Position)
            if OnScreen and IsVisible(Part) then
                local MouseDist = (Center - Vector2.new(ScreenPos.X, ScreenPos.Y)).Magnitude
                if MouseDist < Distance then Distance = MouseDist; Target = v end
            end
        end
    end
    return Target
end

RunService.RenderStepped:Connect(function()
    FOVCircle.Visible = _G.U_HUB_CORE.FovEnabled and _G.U_HUB_CORE.AimbotEnabled
    FOVCircle.Radius = _G.U_HUB_CORE.FovRadius
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    if _G.U_HUB_CORE.AimbotEnabled then
        local Target = GetClosestPlayer()
        if Target then
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, Target.Character[_G.U_HUB_CORE.AimPart].Position), _G.U_HUB_CORE.Sensitivity)
        end
    end
end)

Window:SelectTab(1)
Fluent:Notify({Title = "U-HUB", Content = "ปุ่มลอย + ล็อคเฉพาะที่เห็น มาแล้วครับ!", Duration = 5})


-- [[ ระบบปลดเมาส์แบบบังคับ ]]
RunService.RenderStepped:Connect(function()
    if not Window.Minimized and _G.U_HUB_CORE.UnlockMouse then
        UserInputService.MouseIconEnabled = true
        -- บังคับโหมดเมาส์ให้เป็นอิสระ (ไม่โดนเกมดึงไปกลางจอ)
        UserInputService.MouseBehavior = Enum.MouseBehavior.Default
    elseif Window.Minimized then
        -- ถ้าปิดเมนู ให้เมาส์กลับไปเป็นตามที่เกมกำหนด
        UserInputService.MouseBehavior = Enum.MouseBehavior.LockCenter
    end
end)


-- [ ปุ่มซ่อน/โชว์ FOV ]
Tabs.Visuals:AddToggle("ShowFOV", {Title = "Show FOV Circle", Default = true}):OnChanged(function(v) 
    _G.U_HUB_CORE.FovEnabled = v 
end)

-- [ ปุ่มปลดเมาส์ ]
Tabs.Combat:AddToggle("MouseLock", {Title = "Unlock Mouse", Default = true}):OnChanged(function(v) 
    _G.U_HUB_CORE.UnlockMouse = v 
end)


RunService.RenderStepped:Connect(function()
    -- ถ้าปิด Toggle หรือไม่ได้เปิด Aimbot วงกลมจะหายไปทันที
    if _G.U_HUB_CORE.FovEnabled and _G.U_HUB_CORE.AimbotEnabled then
        FOVCircle.Visible = true
        FOVCircle.Radius = _G.U_HUB_CORE.FovRadius
        FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    else
        FOVCircle.Visible = false
    end
end)


