local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
math.randomseed(tick())

-- [[ 1. SETTINGS CORE ]]
_G.U_HUB_CORE = {
    AutoLockNoClick = false, 
    AimPart = "Head",
    Sensitivity = 0.1,
    FovEnabled = true,
    FovRadius = 150,
    LockMode = "Normal (ระยะสายตา)", 
    UnlockMouse = true
}

-- [[ 2. สร้างหน้าต่างหลัก ]]
local Window = Fluent:CreateWindow({
    Title = "U-HUB SUPREME",
    SubTitle = "BY Neung",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false, 
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.U 
})

-- [[ 3. ระบบปลดล็อคเมาส์ ]]
RunService.RenderStepped:Connect(function()
    if _G.U_HUB_CORE.UnlockMouse and not Window.Minimized then
        UserInputService.MouseIconEnabled = true
        UserInputService.MouseBehavior = Enum.MouseBehavior.Default
    end
end)

-- [[ 4. ระบบปุ่มลอยวิบวับ (ห้ามลบ!) ]]
local function SetupLogoV50(MainBtn)
    local Container = Instance.new("Frame", MainBtn)
    Container.Size = UDim2.new(1, 0, 1, 0); Container.BackgroundTransparency = 1; Container.ClipsDescendants = true
    for i = 1, 15 do
        local d = Instance.new("Frame", Container)
        d.Size = UDim2.new(0, 1, 0, 1); d.BackgroundColor3 = Color3.fromRGB(255, 255, 255); d.Position = UDim2.new(math.random(), 0, math.random(), 0)
        task.spawn(function() while task.wait(math.random(2, 4)) do TweenService:Create(d, TweenInfo.new(1), {BackgroundTransparency = 1}):Play(); task.wait(1.2); TweenService:Create(d, TweenInfo.new(1), {BackgroundTransparency = 0.4}):Play() end end)
    end
    local function CreateChar(txt, color)
        local h = Instance.new("Frame", Container); h.Size = UDim2.new(1, 0, 1, 0); h.BackgroundTransparency = 1
        local l = Instance.new("TextLabel", h); l.Text = txt; l.TextColor3 = color; l.Font = Enum.Font.GothamBold; l.Size = UDim2.new(1, 0, 1, 0); l.BackgroundTransparency = 1
        task.spawn(function() while true do TweenService:Create(l, TweenInfo.new(1.5, Enum.EasingStyle.Sine), {Position = UDim2.new(0,0,0,2)}):Play(); task.wait(1.5); TweenService:Create(l, TweenInfo.new(1.5, Enum.EasingStyle.Sine), {Position = UDim2.new(0,0,0,-2)}):Play(); task.wait(1.5) end end)
        return h, l
    end
    local holderU, textU = CreateChar("U", Color3.fromRGB(0, 255, 100)); local holderN, textN = CreateChar("N", Color3.fromRGB(0, 170, 255))
    holderU.Position = UDim2.new(0,0,0,0); textU.TextSize = 35; holderN.Position = UDim2.new(-0.25,0,-0.25,0); textN.TextSize = 14
    return function(isMinimized)
        if isMinimized then TweenService:Create(holderU, TweenInfo.new(0.4), {Position = UDim2.new(0,0,0,0)}):Play(); textU.TextSize = 35; TweenService:Create(holderN, TweenInfo.new(0.4), {Position = UDim2.new(-0.25,0,-0.25,0)}):Play(); textN.TextSize = 14
        else TweenService:Create(holderN, TweenInfo.new(0.4), {Position = UDim2.new(0,0,0,0)}):Play(); textN.TextSize = 35; TweenService:Create(holderU, TweenInfo.new(0.4), {Position = UDim2.new(-0.25,0,-0.25,0)}):Play(); textU.TextSize = 14 end
    end
end

local ScreenGui = Instance.new("ScreenGui", game.CoreGui); local MainBtn = Instance.new("Frame", ScreenGui)
MainBtn.Size = UDim2.new(0, 60, 0, 60); MainBtn.Position = UDim2.new(0.1, 0, 0.4, 0); MainBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0); MainBtn.Active = true
Instance.new("UICorner", MainBtn).CornerRadius = UDim.new(0, 12); local UpdateLogo = SetupLogoV50(MainBtn)

local dragging, dragStart, startPos, startTime
MainBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true; startTime = tick(); dragStart = input.Position; startPos = MainBtn.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false
        if tick() - startTime < 0.25 then Window:Minimize(); task.wait(0.05); UpdateLogo(Window.Minimized) end end end)
    end
end)
UserInputService.InputChanged:Connect(function(input) if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then local delta = input.Position - dragStart; MainBtn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)

-- [[ 5. TABS ]]
local Tabs = { Combat = Window:AddTab({ Title = "Combat", Icon = "target" }), Visuals = Window:AddTab({ Title = "Visuals", Icon = "eye" }) }

Tabs.Combat:AddToggle("AutoLock", {Title = "Auto Lock (ไม่ต้องกด)", Default = false}):OnChanged(function(Value) 
    _G.U_HUB_CORE.AutoLockNoClick = Value 
end)

Tabs.Combat:AddDropdown("LockType", {
    Title = "โหมดความโหด",
    Values = {"Normal (ระยะสายตา)", "Hardcore (ล็อคโหด)"},
    Default = "Normal (ระยะสายตา)",
    Callback = function(Value)
        _G.U_HUB_CORE.LockMode = Value
    end
})

Tabs.Combat:AddSlider("Smooth", { Title = "Lock Speed", Default = 0.1, Min = 0.01, Max = 1, Rounding = 2, Callback = function(Value) _G.U_HUB_CORE.Sensitivity = Value end})
Tabs.Visuals:AddSlider("FOVSize", { Title = "POV Radius", Default = 150, Min = 50, Max = 800, Rounding = 0, Callback = function(Value) _G.U_HUB_CORE.FovRadius = Value end})

-- [[ 6. LOGIC ENGINE ]]
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 1; FOVCircle.NumSides = 100; FOVCircle.Color = Color3.fromRGB(255, 255, 255)

local function IsVisible(TargetPart)
    if _G.U_HUB_CORE.LockMode == "Hardcore (ล็อคโหด)" then return true end
    local RayParams = RaycastParams.new()
    RayParams.FilterType = Enum.RaycastFilterType.Exclude
    RayParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    local Result = workspace:Raycast(Camera.CFrame.Position, (TargetPart.Position - Camera.CFrame.Position), RayParams)
    return (Result == nil or Result.Instance:IsDescendantOf(TargetPart.Parent))
end

local function GetClosestPlayer()
    local Target, Distance = nil, _G.U_HUB_CORE.FovRadius
    local Center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild(_G.U_HUB_CORE.AimPart) and v.Character.Humanoid.Health > 0 then
            local Part = v.Character[_G.U_HUB_CORE.AimPart]
            local ScreenPos, OnScreen = Camera:WorldToViewportPoint(Part.Position)
            if OnScreen then
                local MouseDist = (Center - Vector2.new(ScreenPos.X, ScreenPos.Y)).Magnitude
                if MouseDist < Distance and IsVisible(Part) then Distance = MouseDist; Target = v end
            end
        end
    end
    return Target
end

RunService.RenderStepped:Connect(function()
    -- POV จะขึ้นเฉพาะตอนเปิด Auto Lock เท่านั้น!
    FOVCircle.Visible = _G.U_HUB_CORE.AutoLockNoClick
    FOVCircle.Radius = _G.U_HUB_CORE.FovRadius
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    if _G.U_HUB_CORE.AutoLockNoClick then
        local Target = GetClosestPlayer()
        if Target then
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, Target.Character[_G.U_HUB_CORE.AimPart].Position), _G.U_HUB_CORE.Sensitivity)
        end
    end
end)

Window:SelectTab(1)
Fluent:Notify({Title = "U-HUB", Content = "POV จะโชว์เฉพาะตอนเปิดล็อคแล้วนะน้องหนึ่ง!", Duration = 5})


Tabs.Visuals:AddColorpicker("POVColor", {
    Title = "POV Color (สีวงกลม)",
    Default = Color3.fromRGB(255, 255, 255) -- เริ่มต้นเป็นสีขาว
}):OnChanged(function(Value)
    FOVCircle.Color = Value
end)

-- [ สร้างแท็บใหม่ชื่อ ESP        มองทะลุ        ]
Tabs.ESP = Window:AddTab({ Title = "ESP", Icon = "eye" })

-- [ เพิ่มปุ่มควบคุมในแท็บ ESP ]
Tabs.ESP:AddToggle("EspHigh", {Title = "เปิดมองทะลุ (Highlight)", Default = false}):OnChanged(function(Value)
    _G.U_HUB_CORE.EspEnabled = Value
end)

Tabs.ESP:AddColorpicker("EspColor", {
    Title = "เลือกสีตัวละคร",
    Default = Color3.fromRGB(255, 0, 0)
}):OnChanged(function(Value)
    _G.U_HUB_CORE.EspColor = Value
end)

Tabs.ESP:AddSlider("EspTrans", {
    Title = "ความใสของสี",
    Default = 0.5,
    Min = 0,
    Max = 1,
    Rounding = 1,
    Callback = function(Value)
        _G.U_HUB_CORE.EspTrans = Value
    end
})


_G.U_HUB_CORE.EspEnabled = false
_G.U_HUB_CORE.EspColor = Color3.fromRGB(255, 0, 0)
_G.U_HUB_CORE.EspTrans = 0.5


-- [[ ระบบ ESP Highlight ทำงานแยกส่วน ]]
RunService.RenderStepped:Connect(function()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local highlight = player.Character:FindFirstChild("U_ESP_Highlight")
            
            if _G.U_HUB_CORE.EspEnabled then
                if not highlight then
                    highlight = Instance.new("Highlight")
                    highlight.Name = "U_ESP_Highlight"
                    highlight.Parent = player.Character
                end
                highlight.Enabled = true
                highlight.FillColor = _G.U_HUB_CORE.EspColor
                highlight.OutlineColor = Color3.fromRGB(255, 255, 255) -- ขอบขาวเสมอให้เห็นชัด
                highlight.FillTransparency = _G.U_HUB_CORE.EspTrans
            else
                if highlight then
                    highlight.Enabled = false
                end
            end
        end
    end
end)


-- [[ 1. ระบบ Anti-Detection & Anti-Kick (วางบนสุด) ]]
local function SecureScript()
    local g = getgenv()
    local namecall; namecall = hookmetamethod(game, "__namecall", function(self, ...)
        local method = getnamecallmethod()
        local args = {...}
        
        -- ดักจับการ Kick จากระบบ (ถ้าเกมสั่ง Kick ให้ยกเลิก)
        if not checkcaller() and (method == "Kick" or method == "kick") then
            print("Blocked a Kick attempt!")
            return nil
        end

        -- ป้องกันการส่งค่า Log บางอย่างที่ผิดปกติกลับไปที่ Server
        if method == "FireServer" and (self.Name == "RemoteEvent" or self.Name:find("Log")) then
            return nil
        end

        return namecall(self, ...)
    end)
    
    -- ซ่อนสคริปต์จากตัวตรวจจับ Memory
    if g.setfflag then
        g.setfflag("AbuseReportScreenshot", "False")
        g.setfflag("RbxCrashUploadEnabled", "False")
    end
end

pcall(SecureScript)


-- [[ 1. เลือกรูปแบบ ESP (เอาแค่ 2 แบบตามสั่งเลย) ]]
local ESP_Style = Tabs.ESP:AddDropdown("ESP_Style", {
    Title = "เลือกรูปแบบการมอง",
    Values = {"ปิด", "ตัวเรืองแสง (Chams)", "เส้นขอบ (Outline)"},
    Multi = false,
    Default = "ปิด",
})

ESP_Style:OnChanged(function(Value)
    _G.ESP_Selected = Value
end)

-- [[ 2. ตัวเปลี่ยนสีอันเดียว (คุมทุกแบบ) ]]
local EspColor = Tabs.ESP:AddColorpicker("EspColor", {
    Title = "สีของ ESP",
    Default = Color3.fromRGB(255, 0, 0)
})

EspColor:OnChanged(function(Value)
    _G.U_HUB_CORE.EspColor = Value
end)


task.spawn(function()
    while task.wait(0.1) do
        pcall(function()
            for _, player in pairs(game.Players:GetPlayers()) do
                if player ~= game.Players.LocalPlayer and player.Character then
                    local char = player.Character
                    local highlight = char:FindFirstChild("U_ESP_Master") or Instance.new("Highlight", char)
                    highlight.Name = "U_ESP_Master"
                    
                    local useColor = _G.U_HUB_CORE.EspColor or Color3.fromRGB(255, 0, 0)
                    
                    if _G.ESP_Selected == "ตัวเรืองแสง (Chams)" then
                        highlight.Enabled = true
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 1
                        highlight.FillColor = useColor
                    elseif _G.ESP_Selected == "เส้นขอบ (Outline)" then
                        highlight.Enabled = true
                        highlight.FillTransparency = 1
                        highlight.OutlineTransparency = 0
                        highlight.OutlineColor = useColor
                    else
                        highlight.Enabled = false
                    end
                end
            end
        end)
    end
end)


-- ปุ่มปรับความหนาของเส้นขอบ ESP
Tabs.Visuals:AddSlider("OutlineThickness", {
    Title = "ความหนาของเส้นขอบ",
    Description = "ใช้ปรับความหนาเวลาเลือกโหมด Outline",
    Default = 2,
    Min = 1,
    Max = 10,
    Rounding = 1,
    Callback = function(Value)
        _G.OutlineThickness = Value
    end
})


task.spawn(function()
    while task.wait(0.1) do
        pcall(function()
            for _, player in pairs(game.Players:GetPlayers()) do
                if player ~= game.Players.LocalPlayer and player.Character then
                    local char = player.Character
                    local highlight = char:FindFirstChild("U_ESP_Master") or Instance.new("Highlight", char)
                    highlight.Name = "U_ESP_Master"
                    
                    local useColor = _G.U_HUB_CORE.EspColor or Color3.fromRGB(255, 0, 0)
                    local thickness = _G.OutlineThickness or 2 -- ถ้าไม่ได้ปรับ ให้หนา 2 เป็นค่าเริ่มต้น
                    
                    if _G.ESP_Selected == "ตัวเรืองแสง (Chams)" then
                        highlight.Enabled = true
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 1
                        highlight.FillColor = useColor
                    elseif _G.ESP_Selected == "เส้นขอบ (Outline)" then
                        highlight.Enabled = true
                        highlight.FillTransparency = 1
                        highlight.OutlineTransparency = 0
                        highlight.OutlineColor = useColor
                        highlight.OutlineThickness = thickness -- << เพิ่มบรรทัดนี้เพื่อปรับความหนาครับ!
                    else
                        highlight.Enabled = false
                    end
                end
            end
        end)
    end
end)



-- [[ 1. เลือกรูปแบบ (เรืองแสง หรือ เส้นขอบ) ]]
Tabs.Visuals:AddDropdown("ESP_Style", {
    Title = "เลือกรูปแบบ ESP",
    Values = {"ปิด", "ตัวเรืองแสง (Chams)", "เส้นขอบ (Outline)"},
    Default = "ปิด",
    Callback = function(Value) _G.ESP_Selected = Value end
})

-- [[ 2. ตัวเปลี่ยนสีอันเดียวจบ (คุมทุกอย่าง) ]]
Tabs.Visuals:AddColorpicker("MainEspColor", {
    Title = "เปลี่ยนสีตัวละคร",
    Default = Color3.fromRGB(255, 0, 0)
}):OnChanged(function(Value)
    _G.MainColor = Value -- ใช้ตัวแปรเดียวคุมสีทั้งสคริปต์
end)

-- [[ 3. ปรับความกว้างเส้นขอบ ]]
Tabs.Visuals:AddSlider("OutlineThickness", {
    Title = "ความหนาของเส้น",
    Default = 2, Min = 1, Max = 10, Rounding = 1,
    Callback = function(Value) _G.Thickness = Value end
})


task.spawn(function()
    while task.wait(0.1) do
        pcall(function()
            for _, player in pairs(game.Players:GetPlayers()) do
                if player ~= game.Players.LocalPlayer and player.Character then
                    local char = player.Character
                    local highlight = char:FindFirstChild("U_ESP_Master") or Instance.new("Highlight", char)
                    highlight.Name = "U_ESP_Master"
                    
                    -- ดึงสีจากอันเดียวที่เลือก
                    local color = _G.MainColor or Color3.fromRGB(255, 0, 0)
                    local thick = _G.Thickness or 2
                    
                    if _G.ESP_Selected == "ตัวเรืองแสง (Chams)" then
                        highlight.Enabled = true
                        highlight.FillColor = color
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 1 -- ปิดขอบตอนเรืองแสง
                    elseif _G.ESP_Selected == "เส้นขอบ (Outline)" then
                        highlight.Enabled = true
                        highlight.FillTransparency = 1    -- ปิดสีตัว (เอาแต่ขอบ)
                        highlight.OutlineColor = color
                        highlight.OutlineTransparency = 0
                        highlight.OutlineThickness = thick
                    else
                        highlight.Enabled = false
                    end
                end
            end
        end)
    end
end)
